import numpy as np
from numpy import sqrt
from numpy import exp
from numpy import pi
from scipy.special import erf

def hessian2(x, y, x0, y0, sigma):
    h_xx = (sqrt(2)*(-2*x + 2*x0 - 1.0)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**3) - sqrt(2)*(-2*x + 2*x0 + 1.0)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**3))*(-erf(sqrt(2)*(y - y0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(y - y0 + 0.5)/(2*sigma)))
    h_xy = (-sqrt(2)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))*(-sqrt(2)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))
    h_xs = (-sqrt(2)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))*(sqrt(2)*(y - y0 - 0.5)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*(y - y0 + 0.5)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2)) + (-erf(sqrt(2)*(y - y0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(y - y0 + 0.5)/(2*sigma)))*(sqrt(2)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) + sqrt(2)*(x - x0 - 0.5)**2*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**4) - sqrt(2)*(x - x0 + 0.5)**2*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**4))
    h_yx = (-sqrt(2)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))*(-sqrt(2)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))
    h_yy = (sqrt(2)*(-2*y + 2*y0 - 1.0)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**3) - sqrt(2)*(-2*y + 2*y0 + 1.0)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**3))*(-erf(sqrt(2)*(x - x0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(x - x0 + 0.5)/(2*sigma)))
    h_ys = (-sqrt(2)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))*(sqrt(2)*(x - x0 - 0.5)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*(x - x0 + 0.5)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2)) + (-erf(sqrt(2)*(x - x0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(x - x0 + 0.5)/(2*sigma)))*(sqrt(2)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) + sqrt(2)*(y - y0 - 0.5)**2*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**4) - sqrt(2)*(y - y0 + 0.5)**2*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**4))
    h_sx = (-sqrt(2)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))*(sqrt(2)*(y - y0 - 0.5)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*(y - y0 + 0.5)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2)) + (-erf(sqrt(2)*(y - y0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(y - y0 + 0.5)/(2*sigma)))*(sqrt(2)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) + sqrt(2)*(-2*x + 2*x0 - 1.0)*(x - x0 + 0.5)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**4) - sqrt(2)*(-2*x + 2*x0 + 1.0)*(x - x0 - 0.5)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**4))
    h_sy = (-sqrt(2)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma) + sqrt(2)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma))*(sqrt(2)*(x - x0 - 0.5)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*(x - x0 + 0.5)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2)) + (-erf(sqrt(2)*(x - x0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(x - x0 + 0.5)/(2*sigma)))*(sqrt(2)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) + sqrt(2)*(-2*y + 2*y0 - 1.0)*(y - y0 + 0.5)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**4) - sqrt(2)*(-2*y + 2*y0 + 1.0)*(y - y0 - 0.5)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(2*sqrt(pi)*sigma**4))
    h_ss = 2*(sqrt(2)*(x - x0 - 0.5)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*(x - x0 + 0.5)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2))*(sqrt(2)*(y - y0 - 0.5)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2) - sqrt(2)*(y - y0 + 0.5)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**2)) + (-erf(sqrt(2)*(x - x0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(x - x0 + 0.5)/(2*sigma)))*(-2*sqrt(2)*(y - y0 - 0.5)*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**3) + 2*sqrt(2)*(y - y0 + 0.5)*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**3) + sqrt(2)*(y - y0 - 0.5)**3*exp(-(y - y0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**5) - sqrt(2)*(y - y0 + 0.5)**3*exp(-(y - y0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**5)) + (-erf(sqrt(2)*(y - y0 - 0.5)/(2*sigma)) + erf(sqrt(2)*(y - y0 + 0.5)/(2*sigma)))*(-2*sqrt(2)*(x - x0 - 0.5)*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**3) + 2*sqrt(2)*(x - x0 + 0.5)*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**3) + sqrt(2)*(x - x0 - 0.5)**3*exp(-(x - x0 - 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**5) - sqrt(2)*(x - x0 + 0.5)**3*exp(-(x - x0 + 0.5)**2/(2*sigma**2))/(sqrt(pi)*sigma**5))
    hessian = np.array([[h_xx,h_xy,h_xs], [h_yx,h_yy,h_ys], [h_sx,h_sy,h_ss]], dtype=np.float64)
    return hessian
